version: "3.7"

services:
  # This is Umbrel's built-in reverse proxy sidecar.
  app_proxy:
    environment:
      # Container name pattern: <app-id>_<service-name>_1
      APP_HOST: martinmeel-windscribe-qbittorrent_martinmeel-windscribe-qbittorrent_1
      APP_PORT: 9091

  gluetun:
    image: qmcgaw/gluetun:latest
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      # ===== WINDCRIBE VPN SETTINGS =====
      - VPN_SERVICE_PROVIDER=windscribe
      - VPN_TYPE=openvpn

      # Your Windscribe credentials (set via Umbrel's env editor or exports.sh if you want)
      - OPENVPN_USER=
      - OPENVPN_PASSWORD=

      # Optional Windscribe location filters:
      - SERVER_REGIONS=Netherlands
      - SERVER_CITIES=Amsterdam

      # Timezone
      - TZ=Europe/Amsterdam

    volumes:
      - ${APP_DATA_DIR}/data:/gluetun

  transmission:
    image: lscr.io/linuxserver/transmission:latest
    restart: unless-stopped

    # Key trick: share Gluetun's network namespace
    network_mode: "service:gluetun"
    depends_on:
      - gluetun

    environment:
    #  - PUID=1000
    #  - PGID=1000
      - TZ=Europe/Amsterdam

      # Use a fixed username and Umbrel-provided unique password
      - USER=umbrel
      - PASS=${APP_PASSWORD}

      # Optional Transmission tuning:
      # - TRANSMISSION_DOWNLOAD_DIR=/downloads/completed
      # - TRANSMISSION_INCOMPLETE_DIR=/downloads/incomplete
      # - TRANSMISSION_RATIO_LIMIT=1.0
      # - TRANSMISSION_RATIO_LIMIT_ENABLED=true

    volumes:
      - ${APP_DATA_DIR}/config:/config
      - ${APP_DATA_DIR}/downloads:/downloads
